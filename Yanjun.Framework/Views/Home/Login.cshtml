
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Index</title>
    <link href="~/Extjs/resources/theme-classic-all.css" rel="stylesheet" />
    <link href="~/css/icon.css" rel="stylesheet" />
</head>
<body>


    <script type="text/javascript" src="~/Extjs/ext-all.js"></script>
    <script src="~/Extjs/theme-classic.js"></script>
    <script src="~/js/common.js"></script>
    <script src="~/js/serverCommunication.js"></script>

    <script language="javascript">

        Ext.define('xf.controller.Login', { // #1
            extend: 'Ext.app.ViewController', // #2
            alias: 'controller.login',
            userLogin: function () {
                var form = this.lookup("loginForm");
                var userName = form.getForm().findField("userName").getValue();
                var pwd = form.getForm().findField("password").getValue();
                Ext.Ajax.request({
                    method: 'post',
                    url: '/Staff/Login',
                    params: {
                        userName: userName,
                        pwd: pwd,
                    },
                    success: function (response, opts) {
                        var obj = Ext.decode(response.responseText);
                        if (obj.Success) {
                            Ext.toast("登录成功,正在跳转到主页...", "消息", 't');
                            location.href = "/Home/Index";
                        }
                        else {
                            Ext.Msg.show({
                                title: '消息',
                                msg: obj.Message,
                                buttons: Ext.Msg.OK,
                                icon: Ext.Msg.ERROR
                            });
                        }
                    },

                    failure: function (response, opts) {
                        Ext.Msg.show({
                            title: '消息',
                            msg: '服务器返回异常,请检查服务器是否正常!',
                            buttons: Ext.Msg.OK,
                            icon: Ext.Msg.ERROR
                        });
                    }
                });
            },
            userCancel: function () {
                var form = this.lookup("loginForm");
                form.getForm().reset();
            }
        });



        Ext.define('xf.view.Login', {
            extend: 'Ext.window.Window',
            alias: 'widget.login', // #3
            autoShow: true, // #4
            height: 170, // #5
            width: 360, // #6
            layout: { type: 'fit' },
            controller: 'login',
            iconCls: 'key',
            title: "用户登录", // #9
            closeAction: 'hide', // #10
            closable: false, // #11
            items: [{
                xtype: 'form', // #12
                reference: 'loginForm',
                frame: false, // #13
                bodyPadding: 15, // #14
                defaults: { // #15
                    xtype: 'textfield', // #16
                    anchor: '100%', // #17
                    labelWidth: 60 // #18
                },
                items: [{
                    name: 'userName',
                    fieldLabel: "用户名",
                    allowBlank: false
                }, {
                    inputType: 'password', // #19
                    name: 'password',
                    fieldLabel: "密码",
                    allowBlank: false
                }],
                dockedItems: [{
                    xtype: 'toolbar',
                    dock: 'bottom',
                    items: [{
                        xtype: 'tbfill' //#24
                    }, {
                        xtype: 'button', // #25
                        itemId: 'cancel',
                        iconCls: 'cancel',
                        text: '取消',
                        handler: 'userCancel'
                    }, {
                        xtype: 'button', // #26
                        itemId: 'submit',
                        formBind: true, // #27
                        iconCls: 'key-go',
                        text: "提交",
                        handler: 'userLogin'
                    }]
                }]


            }]


        });

        Ext.onReady(function () {
            var loginWin = Ext.create("xf.view.Login");
            loginWin.show();
        });


    </script>
</body>
</html>
